CREATE ALGORITHM=UNDEFINED DEFINER=`homestead`@`%` SQL SECURITY DEFINER VIEW `pt_ready_participants` AS select `pr`.`readiness_id` AS `readiness_id`,`pr`.`uuid` AS `readiness_uuid`,`pr`.`verdict` AS `verdict`,`pr`.`pt_round_no` AS `pt_round_uuid`,`pr`.`lab_result` AS `lab_result`,`p`.`id` AS `p_id`,`p`.`participant_id` AS `participant_id`,`p`.`uuid` AS `participant_uuid`,`p`.`participant_fname` AS `participant_fname`,`p`.`participant_lname` AS `participant_lname`,`p`.`participant_phonenumber` AS `participant_phonenumber`,`p`.`participant_email` AS `participant_email`,`f`.`id` AS `facility_id`,`f`.`facility_code` AS `facility_code`,`f`.`facility_name` AS `facility_name`,`f`.`G4S_branch_name` AS `G4S_branch_name`,`f`.`G4S_location` AS `G4S_location`,if(isnull(`ptb`.`batch_name`),'No batch assigned',`ptb`.`batch_name`) AS `batch`,`ppt`.`id` AS `panel_tracking_id`,`ppt`.`uuid` AS `panel_tracking_uuid`,`ppt`.`panel_preparation_date` AS `panel_preparation_date`,`ppt`.`courier_collection_date` AS `courier_collection_date`,`ppt`.`participant_received_date` AS `participant_received_date`,`ppt`.`panel_condition_comment` AS `panel_condition_comment`,`ppt`.`receipt` AS `receipt`,(case when isnull(`ppt`.`panel_preparation_date`) then 'Awaiting Preparation' when ((`ppt`.`panel_preparation_date` is not null) and isnull(`ppt`.`courier_collection_date`)) then 'Awaiting Courier Dispatch' when ((`ppt`.`panel_preparation_date` is not null) and (`ppt`.`courier_collection_date` is not null) and isnull(`ppt`.`participant_received_date`)) then 'Awaiting Participant Reception' when ((`ppt`.`panel_preparation_date` is not null) and (`ppt`.`courier_collection_date` is not null) and (`ppt`.`participant_received_date` is not null)) then 'Panel Received' else 'Nothing Yet' end) AS `status`,(case when isnull(`ppt`.`panel_preparation_date`) then 0 when ((`ppt`.`panel_preparation_date` is not null) and isnull(`ppt`.`courier_collection_date`)) then 1 when ((`ppt`.`panel_preparation_date` is not null) and (`ppt`.`courier_collection_date` is not null) and isnull(`ppt`.`participant_received_date`)) then 2 when ((`ppt`.`panel_preparation_date` is not null) and (`ppt`.`courier_collection_date` is not null) and (`ppt`.`participant_received_date` is not null)) then 3 else 4 end) AS `status_code` from (((`participants` `p` left join (`participant_readiness` `pr` left join `pt_panel_tracking` `ppt` on((`pr`.`readiness_id` = `ppt`.`pt_readiness_id`))) on((`p`.`uuid` = `pr`.`participant_id`))) left join `pt_batches` `ptb` on((`ptb`.`id` = `ppt`.`pt_batch_id`))) join `facility` `f` on((`f`.`id` = `p`.`participant_facility`))) where (`pr`.`verdict` = 1)